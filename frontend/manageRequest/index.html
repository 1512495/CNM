<!DOCTYPE html>
<html>

<head>
	<title>Request Management</title>
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<style>
		body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        table, th, td {
            border: 2px solid black;
            border-collapse: collapse;
        }

        #map {
            height: 100%;
        }
    </style>
</head>

<body style="width: 90%;">
	<!-- <div id="app">
		<ul v-if="list">
			<li v-for="request in list" :title="request.id">{{request.name}}</li>
		</ul>
		<button type="button" @click="addCategory">
			add
		</button>
	</div> -->

	<div id="app" style="width: 90%; height: 40%; overflow: auto;">
		<table>
			<thead>
				<tr>
					<th>Họ tên</th>
					<th>Số điện thoại</th>
					<th>Địa chỉ</th>
					<th>Ghi chú</th>
					<th>Trạng thái</th>
					<th>Tài xế</th>
				</tr>
			</thead>
			<tbody v-if="list">
				<tr v-for="request in list" :title="request.id">
					<td>{{request.name}}</td>
					<td>{{request.phone}}</td>
					<td>{{request.address}}</td>
					<td>{{request.note}}</td>
					<td v-if="request.status === 0">Chưa định vị</td>
					<td v-else-if="request.status === 1">Đã định vị</td>
					<td v-else-if="request.status === 2">Đã có xe nhận</td>
					<td v-else-if="request.status === 3">Đang di chuyển</td>
					<td v-else>Đã hoàn thành</td>
					<td><button v-if="request.driver_id" data-toggle="modal" data-target="#myModal" @click="driverInfo(request.driver_id)">Xem
							thông tin</button></td>
				</tr>

			</tbody>
		</table>

		<!-- Modal -->
		<div class="modal fade" id="myModal" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Thông tin tài xế</h4>
					</div>
					<div class="modal-body" v-if="user">
						<p>Họ tên: {{user.name}}</p>
						<p>SĐT: {{user.username}}</p>
						<p>Giới tính: {{user.username}}</p>
						<p>Địa chỉ hiện tại: {{user.username}}</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>

			</div>
		</div>
	</div>




	<script>
		var vm = new Vue({

			el: '#app',
			data: {
				list: [],
				user: {},
			},
			created: function () {
				axios.get('http://localhost:3000/request').then((response) => {
					this.list = response.data;
					//console.log(vm.list);
				})
			},
			methods: {
				driverInfo: function (id) {
					axios.get('http://localhost:3000/user/' + id).then((response) => {
						this.user = response.data[0];
						console.log(response.data);
					})
				}
			}
		});




		let data;
		var socket = io('http://localhost:3000');
		socket.on('new address added', (msg) => {
			axios.get('http://localhost:3000/request').then((response) => {
				console.log(vm);
				if (vm) {
					vm.list = response.data;
				}
			})
		});
	</script>


	<div id="map"></div>
	<script>
		var map;
		function initMap() {
			map = new google.maps.Map(document.getElementById('map'), {
				center: { lat: 10.762622, lng: 106.660172 },
				zoom: 15
			});
		}
	</script>

	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBl4QyHMxlZar0aVUVaJmEbqYV8TioCQLM&callback=initMap">
	</script>
</body>

</html>